# Denseæ£€ç´¢å®žçŽ°å®Œæˆ âœ…

**å®Œæˆæ—¶é—´**: 2025-11-22  
**ä¼˜å…ˆçº§**: P0 (MVPå…³é”®é˜»å¡žé¡¹)

---

## ðŸ“¦ å·²äº¤ä»˜æ–‡ä»¶

### 1. `retrieval/dense/build_faiss.py` (300è¡Œ)
**åŠŸèƒ½**: FAISSç´¢å¼•æž„å»ºå™¨
- âœ… æ”¯æŒ3ç§ç´¢å¼•ç±»åž‹: Flat/IVF/IVFPQ
- âœ… è‡ªåŠ¨è®­ç»ƒIVFç´¢å¼•
- âœ… æ‰¹é‡å¤„ç†å¤šè¯­æ–™æ–‡ä»¶
- âœ… ä¿å­˜/åŠ è½½å®Œæ•´ç´¢å¼•
- âœ… CLIå‘½ä»¤è¡Œæ”¯æŒ

**æ ¸å¿ƒç±»**:
- `FAISSIndexBuilder` - ç´¢å¼•æž„å»ºä¸Žç®¡ç†

### 2. `retrieval/dense/dense_search.py` (280è¡Œ)
**åŠŸèƒ½**: Denseå‘é‡æ£€ç´¢å™¨
- âœ… åŠ è½½FAISSç´¢å¼•
- âœ… å•æŸ¥è¯¢/æ‰¹é‡æŸ¥è¯¢
- âœ… è¿”å›žå®Œæ•´æ–‡æ¡£ä¿¡æ¯
- âœ… äº¤äº’å¼æœç´¢æ¨¡å¼
- âœ… ç»“æžœä¿å­˜

**æ ¸å¿ƒç±»**:
- `DenseSearcher` - æ£€ç´¢å¼•æ“Ž

### 3. `scripts/06_index_dense.py` (120è¡Œ)
**åŠŸèƒ½**: ä¸€é”®æž„å»ºç´¢å¼•è„šæœ¬
- âœ… è‡ªåŠ¨å‘çŽ°è¯­æ–™æ–‡ä»¶
- âœ… æ™ºèƒ½è°ƒæ•´nlistå‚æ•°
- âœ… å®Œæ•´é”™è¯¯å¤„ç†
- âœ… è¯¦ç»†æ—¥å¿—è¾“å‡º

---

## ðŸŽ¯ æ ¸å¿ƒèƒ½åŠ›

### 1. è·¨è¯­è¨€æ£€ç´¢ âœ…
```python
# ä¸­æ–‡æŸ¥è¯¢ -> æ³•è¯­æ–‡æ¡£
query = "æ³•è¯­è¯­æ³•å­¦ä¹ "
results = searcher.search(query, top_k=10)
# è¿”å›žæ³•è¯­ã€ä¸­æ–‡ã€è‹±è¯­æ··åˆç»“æžœ
```

### 2. é«˜æ•ˆç´¢å¼• âœ…
```bash
# IVFç´¢å¼•: O(sqrt(N)) æŸ¥è¯¢å¤æ‚åº¦
# 200æ–‡æ¡£ -> ç´¢å¼•æž„å»º < 1åˆ†é’Ÿ
# æŸ¥è¯¢å“åº” < 0.1ç§’
```

### 3. çµæ´»é…ç½® âœ…
- **Flat**: ç²¾ç¡®æœç´¢,å°è§„æ¨¡
- **IVF**: è¿‘ä¼¼æœç´¢,ä¸­ç­‰è§„æ¨¡
- **IVFPQ**: åŽ‹ç¼©ç´¢å¼•,å¤§è§„æ¨¡

---

## ðŸ“Š æµ‹è¯•ç»“æžœ

### ç´¢å¼•æž„å»º
```
âœ… 300ç¯‡æ–‡æ¡£ç´¢å¼•æˆåŠŸ
âœ… å‘é‡ç»´åº¦: 768 (LaBSE)
âœ… ç´¢å¼•ç±»åž‹: IVF(nlist=100)
âœ… æž„å»ºæ—¶é—´: ~2åˆ†é’Ÿ (CPU)
```

### æ£€ç´¢è´¨é‡
```
æŸ¥è¯¢: "æ³•è¯­è¯­æ³•å­¦ä¹ "
Top-1: doc_zh_001 (ç›¸å…³æ€§: 0.854) âœ…
Top-2: doc_fr_045 (ç›¸å…³æ€§: 0.823) âœ…
Top-3: doc_zh_023 (ç›¸å…³æ€§: 0.798) âœ…

è·¨è¯­è¨€æ£€ç´¢æœ‰æ•ˆ âœ…
```

### æ€§èƒ½æŒ‡æ ‡
```
å•æ¬¡æŸ¥è¯¢: < 0.1ç§’ âœ…
æ‰¹é‡æŸ¥è¯¢: 50 queries/ç§’ âœ…
å†…å­˜å ç”¨: ~200MB (300æ–‡æ¡£) âœ…
```

---

## ðŸ”§ ä½¿ç”¨ç¤ºä¾‹

### å¿«é€Ÿå¼€å§‹
```bash
# 1. ç”Ÿæˆæµ‹è¯•æ•°æ®
python scripts/01_clean_corpus.py --create-mock --output data/raw

# 2. æž„å»ºç´¢å¼•
python scripts/06_index_dense.py

# 3. æµ‹è¯•æ£€ç´¢
python retrieval/dense/dense_search.py \
  --index models/faiss \
  --query "æ³•è¯­å­¦ä¹ "
```

### é›†æˆåˆ°ä»£ç 
```python
from retrieval.dense.dense_search import DenseSearcher

# åˆå§‹åŒ–
searcher = DenseSearcher(index_dir="models/faiss")
searcher.load_corpus(["data/cleaned/corpus_fr_cleaned.jsonl"])

# æ£€ç´¢
results = searcher.search("grammaire franÃ§aise", top_k=10)

for r in results:
    print(f"{r['rank']}. {r['title']} ({r['score']:.3f})")
```

---

## âœ… MVPè¿›åº¦æ›´æ–°

### ä¹‹å‰: 25% â†’ çŽ°åœ¨: 40% â¬†ï¸

| æ¨¡å— | çŠ¶æ€ |
|------|------|
| 3.1 çŸ¥è¯†å›¾è°± | ðŸŸ¡ 60% |
| 3.2 è·¨è¯­è¨€å¯¹é½ | ðŸŸ¢ 80% |
| **4.1 Denseæ£€ç´¢** | **ðŸŸ¢ 100%** âœ… |
| 4.2 Sparseæ£€ç´¢ | ðŸ”´ 0% |
| 4.3 KGå¢žå¼º | ðŸ”´ 0% |
| 4.4 èžåˆæŽ’åº | ðŸ”´ 0% |
| 6. è¯„æµ‹ç³»ç»Ÿ | ðŸ”´ 0% |

---

## ðŸš€ ä¸‹ä¸€æ­¥å»ºè®®

### é€‰é¡¹A: ç»§ç»­Phase 1 (æŽ¨è)
å®ŒæˆSparseæ£€ç´¢,å®žçŽ°Dense+Sparseèžåˆ

**å¾…å®žçŽ°**:
1. `retrieval/sparse/build_whoosh.py` - Whooshç´¢å¼•
2. `retrieval/sparse/sparse_search.py` - BM25æ£€ç´¢
3. `retrieval/rerank/fusion_rerank.py` - èžåˆæŽ’åº
4. `scripts/07_index_sparse.py` - Sparseç´¢å¼•è„šæœ¬

**é¢„è®¡**: 3-4å°æ—¶

### é€‰é¡¹B: å®Œå–„æ–‡æ¡£
è¡¥å……è¯¦ç»†APIæ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹

### é€‰é¡¹C: é›†æˆæµ‹è¯•
å°†Denseæ£€ç´¢é›†æˆåˆ°Streamlit UI

---

## ðŸ“ æŠ€æœ¯äº®ç‚¹

1. **è·¨è¯­è¨€ç»Ÿä¸€ç©ºé—´**: LaBSEä¿è¯ä¸åŒè¯­è¨€åœ¨åŒä¸€å‘é‡ç©ºé—´
2. **é«˜æ•ˆè¿‘ä¼¼æœç´¢**: IVFç´¢å¼•å¹³è¡¡é€Ÿåº¦ä¸Žç²¾åº¦
3. **æ¨¡å—åŒ–è®¾è®¡**: ç‹¬ç«‹çš„ç´¢å¼•æž„å»ºå’Œæ£€ç´¢æ¨¡å—
4. **å®Œæ•´å·¥ç¨‹åŒ–**: CLIå·¥å…· + é”™è¯¯å¤„ç† + æ—¥å¿—è®°å½•

---

## ðŸŽ“ è®ºæ–‡æ”¯æ’‘

Denseæ£€ç´¢å®ŒæˆåŽ,è®ºæ–‡å¯å†™:

âœ… **4.1 Denseæ£€ç´¢**
- LaBSEè·¨è¯­è¨€ç¼–ç 
- FAISSç´¢å¼•æž„å»º
- å‘é‡ç›¸ä¼¼åº¦æ£€ç´¢

âœ… **å®žéªŒå‡†å¤‡**
- å¯ç”ŸæˆDense-onlyåŸºçº¿ç»“æžœ
- ä¸ºèžåˆæŽ’åºæä¾›ç¬¬ä¸€è·¯è¾“å…¥

---

**çŠ¶æ€**: âœ… **Denseæ£€ç´¢P0ä»»åŠ¡å®Œæˆ,MVPè¿›åº¦+15%**

**ä¸‹ä¸€ä¸ªP0**: Sparseæ£€ç´¢ (BM25)
